<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Panel de Control Valencia</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Centro de Monitoreo DevOps</h1>
        <p>Reporte para mi bebÃ© y Valencia 2026</p>

        <section class="card">
            <h2 class="precio-{{ tendencia }}">
                    ğŸ’° Criptomonedas 
                    {% if tendencia == 'subio' %} ğŸ“ˆ {% elif tendencia == 'bajo' %} ğŸ“‰ {% endif %}
                </h2>
            <table>
                <tr><th>Moneda</th><th>Precio</th></tr>
                {% for registro in lista_criptos %}
                <tr>
                    <td>{{ registro[1] }}</td>
                    <td>${{ registro[2] }}</td>
                </tr>
                {% endfor %}
            </table>
        </section>

        <section class="card">
            <h2>ğŸŒ¡ï¸ Clima</h2>
            <table>
                <tr><th>Temperatura</th></tr>
                {% for registro in lista_clima %}
                <tr>
                    <td>{{ registro[1] }}Â°C</td>
                </tr>
                {% endfor %}
            </table>
        </section>
    </div>
    <button id="btn-actualizar" class="btn-pro">ğŸ”„ Actualizar Datos Ahora</button>

<script>
document.getElementById('btn-actualizar').onclick = function() {
    this.innerText = "â³ Actualizando...";
    this.disabled = true;

    // Enviamos la peticiÃ³n POST al servidor
    fetch('/actualizar-ahora', { method: 'POST' })
    .then(response => response.json())
    .then(data => {
        if(data.status === 'ok') {
            alert("âœ… Datos actualizados: BTC $" + data.btc);
            location.reload(); // Recarga la pÃ¡gina para ver los nuevos datos en la tabla
        } else {
            alert("âŒ Error: " + data.mensaje);
        }
    })
    .catch(error => console.error('Error:', error))
    .finally(() => {
        this.innerText = "ğŸ”„ Actualizar Datos Ahora";
        this.disabled = false;
    });
};
</script>
</body>
</html>